{% from "govuk/components/back-link/macro.njk" import govukBackLink %}
{% from "./macros/common-components.njk" import submitButton %}
{% from "govuk/components/input/macro.njk" import govukInput %}
{% from "govuk/components/checkboxes/macro.njk" import govukCheckboxes %}
{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "moj/components/filter/macro.njk" import mojFilter %}

{% extends "template.njk" %}
{% block pageTitle %}
    {{ title }}
{% endblock %}
{% block beforeContent %}
    {{ govukBackLink({
        text: text,
        href: '#',
        attributes: {
            onClick: "history.back();event.preventDefault();"
        }
    }) }}
{% endblock %}
{% block content %}
    {% set filterOptionsHtml %}
        {% for component in checkBoxesComponents %}
            {{ govukCheckboxes(component) }}
        {% endfor %}
    {% endset %}

    <h1 class="govuk-heading-l">{{ heading }}</h1>
    <p class="govuk-body">{{ subHeading }}</p>
    <div class="moj-filter-layout">
        <form class="moj-filter-layout__filter" method="post" action="court-name-search">
            {{ mojFilter({
                heading: {
                    text: filter
                },
                selectedFilters: {
                    clearLink: {
                        text: filterClear,
                        href: '?clear=all'
                    },
                    heading: {
                        text: filterSelected
                    },
                    categories: categories
                },
                optionsHtml: filterOptionsHtml
            }) }}
        </form>
        <div class="moj-filter-layout__content">
            <form class="moj-action-bar" action="pending-subscriptions" method="post">
                <h2 class="govuk-heading-m">{{ userSelections }}</h2>
                <div class="selection-counter-box govuk-!-padding-top-3 govuk-!-padding-bottom-1 govuk-!-padding-left-2 govuk-!-padding-right-2 govuk-!-margin-bottom-4">
                    <p class="govuk-body"><span id="selectionCount">0</span> {{ selected }}</p>
                </div>
                {{ submitButton() }}
                <hr />
                <div class="govuk-!-margin-bottom-6 govuk-!-margin-top-6">
                    <div class="govuk-grid-row">
                        {% for key, value in alphabeticalCourts %}
                        {% if key == 'N' %}
                    </div>
                    <div class="govuk-grid-row">
                        {% endif %}
                        {% if value| length == 0 %}
                            <div class="govuk-grid-column two-rows-alphabet govuk-!-font-size-19">
                                <a id='{{ key }}-selector' class="govuk-link govuk-link--no-underline">{{ key }}</a>
                            </div>
                        {% else %}
                            <div class="govuk-grid-column two-rows-alphabet govuk-!-font-size-19">
                                <a id='{{ key }}-selector' href='#{{ key }}' class="govuk-link govuk-link--no-visited-state">{{ key }}</a>
                            </div>
                        {% endif %}
                        {% endfor %}
                    </div>
                </div>
            </form>
            <div class="moj-scrollable-pane">
                <div class="moj-scrollable-pane__wrapper">
                    <table class="govuk-table">
                        <thead class="govuk-table__head">
                        <tr class="govuk-table__row">
                            <th scope="col" class="govuk-table__header" colspan="3">{{ tableHeader }}</th>
                        </tr>
                        </thead>
                        <tbody class="govuk-table__body">
                        {% set first = '' %}
                        {% for key, value in alphabeticalCourts %}
                            {% if value | length > 0 %}
                                {% for courtName, courtDetails in value %}
                                    <tr  class="govuk-table__row">
                                        {% if first != key %}
                                            {% set first = key %}
                                            <th scope="row" class="govuk-table__header">
                                                <div id="{{ key }}" class="govuk-!-font-size-36">{{key}}</div>
                                            </th>

                                        {% else %}
                                            <th scope="row" class="govuk-table__header">
                                            </th>
                                        {% endif %}
                                        <td class="govuk-table__cell">
                                            <div class="govuk-checkboxes__item govuk-checkboxes--small moj-multi-select__checkbox">
                                                <input type="checkbox" class="govuk-checkboxes__input" id="{{ courtDetails.id }}"
                                                       value="{{ courtDetails.id }}" name="court-checkbox" onclick="calculateChecked()">
                                                <label class="govuk-label govuk-checkboxes__label" for="{{ courtDetails.id }}">
                                                    <span class="govuk-visually-hidden">Select {{ courtName }}</span>
                                                </label>
                                            </div>
                                        </td>
                                        <td class="govuk-table__cell govuk-!-font-size-19 vertical_align_middle">{{ courtName }}</td>
                                    </tr>
                                {% endfor %}
                                {% set first = '' %}
                            {% endif %}
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block bodyEnd %}
    <script type="text/javascript" src="/assets/js/jquery.js"></script>
    <script type="text/javascript" src="/assets/js/mojAll.js"></script>
    <script>
      function calculateChecked() {
        const checkedBoxes = document.querySelectorAll('input[name="court-checkbox"]:checked').length;
        document.getElementById('selectionCount').innerText = checkedBoxes.toString();
      }
    </script>
{% endblock %}
