{% extends "template.njk" %}
{% from "macros/common-components.njk" import goBack, submitButton %}
{% from "govuk/components/file-upload/macro.njk" import govukFileUpload %}
{% from "govuk/components/input/macro.njk" import govukInput %}
{% from "govuk/components/error-summary/macro.njk" import govukErrorSummary %}

{% block pageTitle %}
  {{ title }}
{% endblock %}
{% block beforeContent %}
  {{ super() }}
  {{ goBack() }}
{% endblock %}
{% block content %}
  {% set nameInput = govukInput({
    label: {
      text: nameLabel
    },
    classes: 'govuk-!-width-one-half',
    id: "fullName",
    name: "fullName",
    errorMessage: {
      text: errors.formErrors.nameError.message
    }
  }) if errors.formErrors.nameError.message else govukInput({
    label: {
      text: nameLabel
    },
    classes: 'govuk-!-width-one-half',
    id: "fullName",
    name: "fullName"
  }) %}

  {% set emailInput = govukInput({
    label: {
      text: emailLabel
    },
    hint: {
      text: emailHint
    },
    classes: "govuk-!-width-one-half",
    id: "emailAddress",
    name: "emailAddress",
    type: 'email',
    autocomplete: 'email',
    spellcheck: false,
    errorMessage: {
      text: errors.formErrors.emailError.message
    }
  }) if errors.formErrors.emailError.message else govukInput({
    label: {
      text: emailLabel
    },
    hint: {
      text: emailHint
    },
    classes: "govuk-!-width-one-half",
    id: "emailAddress",
    name: "emailAddress",
    type: 'email',
    autocomplete: 'email',
    spellcheck: false
  }) %}

  {% set employerInput = govukInput({
    label: {
      text: nameLabel
    },
    classes: 'govuk-!-width-one-half',
    id: "employer",
    name: "employer",
    errorMessage: {
      text: errors.formErrors.employerError.message
    }
  }) if errors.formErrors.employerError.message else govukInput({
    label: {
      text: employerLabel
    },
    classes: "govuk-!-width-one-half",
    id: "employer",
    name: "employer"
  }) %}

  {% set fileInput = govukFileUpload({
    id: "file-upload",
    name: "file-upload",
    label: {
      text: photoType
    },
    errorMessage: {
      text: errors.fileErrors
    }
  }) if errors.fileErrors else govukFileUpload({
    id: "file-upload",
    name: "file-upload",
    label: {
      text: photoType
    }
  }) %}

  {% if errors.formErrors or errors.fileErrors %}
    {% set listErrors = [] %}
    {% for key, option in errors.formErrors %}
      {% set _ = listErrors.push({
        text: option.message,
        href: option.href
      }) %}
    {% endfor %}
    {% if errors.fileErrors %}
      {% set _ = listErrors.push({
        text: errors.fileErrors,
        href: '#file-upload'
      }) %}
    {% endif %}
    <div class="govuk-grid-row">
      <div class="no_padding govuk-grid-column-full">
        {{ govukErrorSummary({
          titleText: errorTitle,
          errorList: listErrors
        }) }}
      </div>
    </div>
  {% endif %}
  <h1 class="govuk-heading-l">{{ header }}</h1>
  <form method="post" enctype="multipart/form-data">
    {{ nameInput }}
    {{ emailInput }}
    {{ employerInput }}
    <p class="govuk-body">{{ photoMessage }}</p>
    <p class="govuk-hint">{{ photoSubMessage }}</p>
    {{ fileInput }}
    {{ submitButton() }}
  </form>
{% endblock %}
{% block bodyEnd %}
  {{ super() }}
  <script>
    {% set fullName = formData['fullName'] if formData['fullName'] else '' %}
    {% set emailAddress = formData['emailAddress'] if formData['emailAddress'] else '' %}
    {% set employer = formData['employer'] if formData['employer'] else '' %}

    document.getElementById('fullName').value = {{ fullName | dump | safe }};
    document.getElementById('emailAddress').value = {{ emailAddress | dump | safe }};
    document.getElementById('employer').value = {{ employer | dump | safe }};


    if (window.history.replaceState) {
      window.history.replaceState(null, null, window.location.href);
    }
  </script>
{% endblock %}
