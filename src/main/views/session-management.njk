{% from "./macros/common-components.njk" import goBack, submitButton %}
{% from "govuk/components/back-link/macro.njk" import govukBackLink %}
{% from "govuk/components/input/macro.njk" import govukInput %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/tag/macro.njk" import govukTag %}
{% from "govuk/components/radios/macro.njk" import govukRadios %}
{% from "govuk/components/summary-list/macro.njk" import govukSummaryList %}


{% extends "template.njk" %}
{% block pageTitle %}
    {{ "Session Management" | safe }}
{% endblock %}

{% block beforeContent %}
    {{ goBack() }}
{% endblock %}

{% block content %}
    <h1 class="govuk-heading-l">Mock User Session Data</h1>
    {% if haveUser %}
        <p class="govuk-body">It seems like user session is already set with following details.</p>
        {{govukTag({
            text: "Session Set",
            classes: "govuk-tag--green govuk-!-margin-bottom-6"
        })}}
        {{ govukSummaryList({
            classes: 'govuk-!-width-one-half',
            rows: [
                {
                    key: {
                        text: 'Username'
                    },
                    value: {
                        text: userDetails['username']
                    }
                },
                {
                    key: {
                        text: 'User ID'
                    },
                    value: {
                        text: userDetails['id']
                    }
                },
                {
                    key: {
                        text: 'User Type'
                    },
                    value: {
                        text: userDetails['userType']
                    }
                }
            ]
        }) }}
        {{ govukButton({
            text: 'Continue',
            href: 'subscription-management'
        }) }}

    {% else %}
        <p class="govuk-body">Use bellow fields to create mock user session required in order to access restricted pages.</p>
        {{govukTag({
            text: "Session Not Set",
            classes: "govuk-tag--red govuk-!-margin-bottom-6"
        })}}
        <form action="mock-login" method="post" class="govuk-!-width-one-half">
            {{ govukInput({
                label: {
                    text: "What is username?"
                },
                id: "username",
                name: "username"
            }) }}
            {{ govukInput({
                label: {
                    text: "What is user id?"
                },
                id: "id",
                name: "id",
                spellcheck: false
            }) }}
            {{ govukRadios({
                idPrefix: "userType",
                name: "userType",
                fieldset: {
                    legend: {
                        text: "What is user type?"
                    }
                },
                items: [
                    {
                        value: "media",
                        text: "Media"
                    },
                    {
                        value: "professional",
                        text: "Professional"
                    }
                ]
            }) }}
            {{ submitButton() }}
        </form>
    {% endif %}
    <script>
      const button = document.getElementsByClassName('govuk-button')[0];
      button.addEventListener('click', (e) => {
        const checkedRadios = document.querySelectorAll('input[type="radio"]:checked');
        const userSet = {{ haveUser | dump |safe }};
        if (!userSet && !checkedRadios.length) {
          e.preventDefault();
        }
      });
    </script>
{% endblock %}
