{% from "govuk/components/table/macro.njk" import govukTable as 'govukTable' %}
{% from "./macros/common-components.njk" import goBack %}
{%- from "govuk/components/checkboxes/macro.njk" import govukCheckboxes -%}
{%- from "moj/components/filter/macro.njk" import mojFilter -%}

{% extends "template.njk" %}
{% block pageTitle %}
  {{ title }}
{% endblock %}
{% block beforeContent %}
  {{ goBack() }}
{% endblock %}
{% block content %}
  <div id="grid-row" class="govuk-grid-row">
    <div class="parent-box layout-width-two-fifths govuk-!-display-inline-block">
      <div class="filter-back-to-top-wrapper">
      <a id="back-to-top-button" class="floating-back-to-top govuk-link govuk-link--no-underline govuk-!-font-size-19"
         href="#">
        <svg focusable="false" class="app-back-to-top__icon" xmlns="http://www.w3.org/2000/svg" width="13" height="17"
             viewBox="0 0 13 17">
          <path fill="currentColor" d="M6.5 0 L0 6.5 1.4 8l4-4v12.7h2V4l4.3 4L13 6.4z"></path>
        </svg>{{ backToTop }}
      </a>
      </div>

    {% set checkedFilters = [] %}
    {% set filterOptionsHtml %}
      {% for key, option in filterOptions %}
        {% set checkedFilterItems = [] %}
        {% set items = [] %}
        {% for value, item in option %}
          {% set _ = items.push({
            value: item.value,
            text: item.text,
            checked: item.checked
          }) %}
          {% if item.checked %}
            {% set _ = checkedFilterItems.push({href: '?clear=' + item.value, text: item.text}) %}
          {% endif %}
        {% endfor %}
        {% if checkedFilterItems| length > 0 %}
          {% set _ = checkedFilters.push({heading: {text: key}, items: checkedFilterItems}) %}
        {% endif %}
        {{ govukCheckboxes({
          idPrefix: key,
          name: key,
          classes: "govuk-checkboxes--small",
          fieldset: {
            legend: {
              text: key,
              classes: 'govuk-fieldset__legend--m'
            }
          },
          items: items
        }) }}
      {% endfor %}
    {% endset %}

    <form method="post" action="alphabetical-search" class="moj-filter-layout__filter layout-width-four-fifths">
      {{ mojFilter({
        heading: {
          text: filter
        },
        selectedFilters: {
          clearLink: {
            text: clearAll,
            href: '?clear=all'
          },
          heading: {
            text: selectedFilter
          },
          categories: checkedFilters
        },
        optionsHtml: filterOptionsHtml
      }) }}
    </form>
    </div>

  <div class="layout-width-three-fifths">
    <h2 id='page-heading' class="govuk-heading-l">{{ heading }}</h2>
    <div class="govuk-grid-row govuk-!-margin-bottom-8">
      {% for key, value in courtList %}
        {% if value| length == 0 %}
          <div class="govuk-grid-column width-column govuk-!-font-size-19">
            <a id='{{ key }}-selector' class="govuk-link govuk-link--no-underline">{{ key }}</a>
          </div>
        {% else %}
          <div class="govuk-grid-column width-column govuk-!-font-size-19">
            <a id='{{ key }}-selector' href='#{{ key }}' class="govuk-link govuk-link--no-visited-state">{{ key }}</a>
          </div>
        {% endif %}
      {% endfor %}
    </div>

    <table class="govuk-table">
      <thead class="govuk-table__head">
      <tr class="govuk-table__row">
        <th scope="col" class="govuk-table__header app-custom-class"></th>
        <th scope="col" class="govuk-table__header">{{ tableHeader1 }}</th>
      </tr>
      </thead>
      <tbody class="govuk-table__body">
      {% for key, value in courtList %}
        {% if value | length > 0 %}
          {% for courtName, courtDetails in value %}
            <tr  class="govuk-table__row">
              {% if first != key %}
                {% set first = key %}
                <th scope="row" class="govuk-table__header">
                  <div id="{{ key }}" class="govuk-!-font-size-27">{{key}}</div>
                </th>
              {% else %}
                <th scope="row" class="govuk-table__header">
                </th>
              {% endif %}
              <td class="govuk-table__cell"><a href="/hearing-list?courtId={{ courtDetails.id }}" class="govuk-link">{{ courtName }}</a></td>
            </tr>
          {% endfor %}
          {% set first = '' %}
        {% endif %}
      {% endfor %}
      </tbody>
    </table>
  </div>
  </div>

{% endblock %}
{% block bodyEnd %}
  {{ super() }}
  <script src="alphabetical-dev.js"></script>
{% endblock %}
