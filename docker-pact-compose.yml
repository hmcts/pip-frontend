version: "3"

services:
    postgres:
        image: postgres:14-alpine
        healthcheck:
            test: psql postgres --command "select 1" -U postgres
        ports:
            - "5432:5432"
        volumes:
            - postgres-volume:/var/lib/postgresql/data
        environment:
            POSTGRES_USER: postgres
            POSTGRES_PASSWORD: password
            POSTGRES_DB: postgres

    pact-broker:
        image: pactfoundation/pact-broker:latest
        ports:
            - "9292:9292"
        depends_on:
            - postgres
        environment:
            PACT_BROKER_DATABASE_USERNAME: postgres
            PACT_BROKER_DATABASE_PASSWORD: password
            PACT_BROKER_DATABASE_HOST: postgres
            PACT_BROKER_DATABASE_NAME: postgres
            PACT_BROKER_PORT: "9292"
            PACT_BROKER_BASIC_AUTH_USERNAME: pact
            PACT_BROKER_BASIC_AUTH_PASSWORD: pact
            PACT_BROKER_ALLOW_PUBLIC_READ: "true"

volumes:
    postgres-volume:
